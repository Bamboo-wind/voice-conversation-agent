<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NovelToComic | å°è¯´è½¬æ¼«ç”»ç”Ÿæˆå¹³å°</title>
<style>
  /* åŸºç¡€æ ·å¼ï¼ˆä¿æŒä½ æä¾›çš„æ˜äº®é£æ ¼ï¼‰ */
  :root {
    --primary-color: #0071e3;
    --secondary-color: #1d1d1f;
    --background-color: #f5f5f7;
    --text-color: #1d1d1f;
    --light-text: #86868b;
    --white: #ffffff;
    --transition: all 0.3s ease;
  }
  * { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; }
  body { background-color:var(--background-color); color:var(--text-color); line-height:1.5; overflow-x:hidden; }

  /* å¯¼èˆªæ  */
  header {
    position:fixed; top:0; width:100%; background-color:rgba(255,255,255,.8);
    backdrop-filter:blur(20px); z-index:1000; padding:0 22px; height:44px;
    display:flex; align-items:center; justify-content:space-between;
  }
  .nav-links { display:flex; list-style:none; }
  .nav-links li { margin:0 15px; }
  .nav-links a { text-decoration:none; color:var(--text-color); font-size:12px; transition:var(--transition); }
  .nav-links a:hover { color:var(--primary-color); }
  .logo { font-weight:600; font-size:21px; color:var(--text-color); }

  /* Hero */
  .hero { height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:0 22px;
    background:linear-gradient(135deg,#f5f5f7 0%,#e8e8ed 100%); }
  .hero h1 { font-size:80px; font-weight:700; letter-spacing:-.015em; margin-bottom:20px; background:linear-gradient(45deg,#1d1d1f,#424245);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
  .hero p { font-size:28px; color:var(--light-text); max-width:700px; margin-bottom:40px; }
  .cta-button { display:inline-block; background-color:var(--primary-color); color:#fff; padding:12px 24px; border-radius:980px; text-decoration:none; font-size:17px; }
  .cta-button:hover { background-color:#0077ED; transform:scale(1.02); }

  /* é€šç”¨å¡ç‰‡/æŒ‰é’®/è¾“å…¥ */
  .section-title { font-size:56px; font-weight:700; text-align:center; margin-bottom:80px; letter-spacing:-.015em; }
  .feature-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:40px; max-width:1200px; margin:0 auto; }
  .feature-card { background:var(--white); border-radius:18px; padding:40px 30px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,.05); }
  .feature-icon { font-size:48px; margin-bottom:20px; }
  .feature-title { font-size:24px; font-weight:600; margin-bottom:15px; }
  .feature-description { font-size:17px; color:var(--light-text); }

  /* ç”Ÿæˆå™¨åŒºåŸŸï¼ˆæˆ‘ä»¬åœ¨æ­¤å¯¹æ¥æ¥å£ + å·¦å³å¸ƒå±€ï¼‰ */
  .generator { padding:120px 22px; background-color:var(--white); }
  .generator-container { max-width:1200px; margin:0 auto; display:grid; grid-template-columns: 480px 1fr; gap:22px; align-items:start; }
  @media (max-width: 980px){ .generator-container{ grid-template-columns:1fr } }

  .left-card,.right-card { background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.06); }
  .left-card h3,.right-card h3{ margin-bottom:8px; }
  .input-area textarea{ width:100%; height:220px; padding:16px; border:1px solid #d2d2d7; border-radius:12px; font-size:16px; resize:vertical; }
  .input-area textarea:focus{ outline:none; border-color:var(--primary-color); }
  .style-options{ display:flex; gap:10px; margin:12px 0 14px; flex-wrap:wrap; }
  .style-option{ padding:8px 14px; border:1px solid #d2d2d7; border-radius:18px; cursor:pointer; }
  .style-option.active{ background:var(--primary-color); color:#fff; border-color:var(--primary-color); }

  .controls-row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:8px 0 4px; }
  .controls-row > *{ flex:1 1 auto; min-width:140px; }
  .select,input[type="number"],input[type="text"],select{ padding:10px; border:1px solid #d2d2d7; border-radius:10px; }
  .generate-btn, .btn { background:var(--primary-color); color:#fff; border:none; padding:12px 16px; border-radius:12px; cursor:pointer; }
  .btn.secondary{ background:#fff; color:var(--primary-color); border:1px solid var(--primary-color); }
  .help{ color:var(--light-text); font-size:12px; margin-top:6px; }

  /* å³ä¾§ç»“æœåŒºï¼šè¿›åº¦ + å›¾æ ¼ */
  .progress{ color:var(--light-text); font-size:14px; margin-top:8px; }
  .comic-panels{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:16px; margin-top:14px; }
  @media (max-width: 1200px){ .comic-panels{ grid-template-columns:repeat(2,1fr) } }
  @media (max-width: 640px){ .comic-panels{ grid-template-columns:1fr } }
  .comic-panel{ background:#f5f5f7; border-radius:12px; overflow:hidden; border:1px solid #e5e7eb; }
  .panel-image{ width:100%; height:220px; background:#e8e8ed; display:flex; align-items:center; justify-content:center; color:var(--light-text); padding:8px; }
  .panel-text{ padding:10px 12px; font-size:14px; border-top:1px solid #e5e7eb; }
  .json-view{ background:#fafafa; border:1px solid #e5e7eb; border-radius:12px; padding:12px; max-height:320px; overflow:auto; font-family:ui-monospace,Consolas,monospace; font-size:12px; }

  /* ç”¨æˆ·æ•…äº‹/æŠ€æœ¯äº®ç‚¹/é¡µè„š â€”â€” ä¿æŒåŸç»“æ„ */
  .features{ padding:120px 22px; max-width:1200px; margin:0 auto; }
  .user-stories{ padding:120px 22px; max-width:1200px; margin:0 auto; }
  .story-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:60px; }
  @media (max-width: 980px){ .story-grid{ grid-template-columns:1fr } }
  .story-card{ background:#fff; border-radius:18px; padding:40px; box-shadow:0 4px 20px rgba(0,0,0,.05); }
  .tech-highlights{ padding:120px 22px; background:#fff; }
  .tech-grid{ display:grid; grid-template-columns:repeat(4,1fr); gap:30px; max-width:1200px; margin:0 auto; }
  @media (max-width: 980px){ .tech-grid{ grid-template-columns:repeat(2,1fr) } }

  footer{ padding:40px 22px; background:var(--secondary-color); color:#fff; text-align:center; }
  .footer-links{ display:flex; justify-content:center; gap:30px; margin-bottom:20px; }
  .footer-links a{ color:#fff; text-decoration:none; font-size:12px; }
</style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <header>
    <div class="logo">NovelToComic</div>
    <ul class="nav-links">
      <li><a href="#features">åŠŸèƒ½</a></li>
      <li><a href="#generator">ç”Ÿæˆå™¨</a></li>
      <li><a href="#stories">ç”¨æˆ·æ•…äº‹</a></li>
      <li><a href="#tech">æŠ€æœ¯äº®ç‚¹</a></li>
    </ul>
  </header>

  <!-- Hero -->
  <section class="hero">
    <h1>NovelToComic</h1>
    <p>å°†æ‚¨çš„å°è¯´æ–‡å­—ï¼Œç¬é—´è½¬åŒ–ä¸ºç²¾ç¾çš„æ¼«ç”»å›¾åƒ</p>
    <a href="#generator" class="cta-button">å¼€å§‹åˆ›ä½œ</a>
  </section>

  <!-- åŠŸèƒ½å±•ç¤ºåŒºåŸŸï¼ˆä¿æŒï¼‰ -->
  <section class="features" id="features">
    <h2 class="section-title">å¼ºå¤§åŠŸèƒ½</h2>
    <div class="feature-grid">
      <div class="feature-card"><div class="feature-icon">ğŸ“–</div><h3 class="feature-title">æ™ºèƒ½åˆ†é•œ</h3><p class="feature-description">AIè‡ªåŠ¨åˆ†æå°è¯´æƒ…èŠ‚ï¼Œç”Ÿæˆåˆç†çš„æ¼«ç”»åˆ†é•œå¸ƒå±€</p></div>
      <div class="feature-card"><div class="feature-icon">ğŸ¨</div><h3 class="feature-title">å¤šç§é£æ ¼</h3><p class="feature-description">æ”¯æŒæ—¥æ¼«ã€ç¾æ¼«ã€é»‘ç™½çº¿ç¨¿ç­‰å¤šç§æ¼«ç”»é£æ ¼</p></div>
      <div class="feature-card"><div class="feature-icon">ğŸ‘¤</div><h3 class="feature-title">è§’è‰²ä¸€è‡´</h3><p class="feature-description">ç¡®ä¿æ‰€æœ‰åˆ†é•œä¸­è§’è‰²å½¢è±¡ä¿æŒä¸€è‡´</p></div>
    </div>
  </section>

  <!-- ç”Ÿæˆå™¨åŒºåŸŸï¼šæ¥å…¥åç«¯ + å·¦å³å¸ƒå±€ + å¹¶å‘é€æ ¼ç”Ÿå›¾ -->
  <section class="generator" id="generator">
    <h2 class="section-title">æ¼«ç”»ç”Ÿæˆå™¨</h2>
    <div class="generator-container">
      <!-- å·¦ï¼šå°è¯´åˆ†é•œ -->
      <div class="left-card">
        <h3>â‘  å°è¯´ â†’ åˆ†é•œï¼ˆLLMï¼‰</h3>
        <div class="input-area">
          <textarea id="novel" placeholder="è¯·è¾“å…¥å°è¯´å†…å®¹...ä¾‹å¦‚ï¼šé›¨å¤œä¸­ï¼Œå°‘å¹´è¿½é€å…‰å½±ï¼Œä»–çš„èº«å½±åœ¨æ¹¿æ¼‰æ¼‰çš„è¡—é“ä¸Šæ‹‰å¾—å¾ˆé•¿..."></textarea>
        </div>
        <div class="style-options" id="styleOptions">
          <div class="style-option active" data-style="æ—¥ç³»æ¸…æ–°" data-prefix="anime style, clean line art, soft lighting">æ—¥å¼æ¼«ç”»</div>
          <div class="style-option" data-style="ç¾æ¼«é£æ ¼" data-prefix="american comic style, bold inking, halftone dots">ç¾å¼æ¼«ç”»</div>
          <div class="style-option" data-style="é»‘ç™½çº¿ç¨¿" data-prefix="black and white manga, line art, screentone, high contrast, dramatic lighting">é»‘ç™½çº¿ç¨¿</div>
          <div class="style-option" data-style="æ°´å½©é£æ ¼" data-prefix="watercolor painting, soft pastel colors">æ°´å½©é£æ ¼</div>
        </div>
        <div class="controls-row">
          <button class="generate-btn" id="btnGenerate">ç”Ÿæˆæ¼«ç”»</button>
          <button class="btn secondary" id="btnClear">æ¸…ç©º</button>
        </div>
        <div class="help">æç¤ºï¼šæƒ³å›ºå®šæ ¼æ•°ï¼Œå¯åœ¨å°è¯´é¦–è¡Œå†™ â€œã€è¦æ±‚ã€‘ä¸€é¡µ 2x2 å…± 4 æ ¼â€ã€‚</div>
        <div style="margin-top:10px">
          <details>
            <summary style="cursor:pointer;color:#0071e3">åˆ†é•œ JSONï¼ˆè°ƒè¯•ç”¨ï¼‰</summary>
            <pre class="json-view" id="sbout">(å¾…ç”Ÿæˆ)</pre>
          </details>
        </div>
      </div>

      <!-- å³ï¼šæ¸²æŸ“æ§åˆ¶ + ç»“æœ -->
      <div class="right-card">
        <h3>â‘¡ æ‰¹é‡æ¸²æŸ“ï¼ˆå‰ç«¯å¹¶å‘ï¼‰</h3>
        <div class="controls-row">
          <select id="sizeBatch">
            <option>1024x1024</option><option>768x1344</option><option>1344x768</option>
          </select>
          <input id="concurrency" type="number" min="1" max="6" value="3" title="å¹¶å‘æ•°"/>
          <input id="pprefix" type="text" placeholder="ç»Ÿä¸€ç”»é£å‰ç¼€ï¼ˆç•™ç©ºåˆ™ä½¿ç”¨å·¦ä¾§é£æ ¼å¯¹åº”çš„é»˜è®¤å‰ç¼€ï¼‰"/>
          <button class="btn" id="btnRenderFE">å¼€å§‹å¹¶å‘æ¸²æŸ“</button>
          <button class="btn secondary" id="btnStop">åœæ­¢</button>
          <button class="btn secondary" id="btnCopy">å¤åˆ¶å…¨éƒ¨é“¾æ¥</button>
        </div>
        <div class="progress" id="progress">è¿›åº¦ï¼š0/0</div>
        <div class="comic-panels" id="renderOut" style="margin-top:12px"></div>
      </div>
    </div>
  </section>

  <!-- ç”¨æˆ·æ•…äº‹ï¼ˆä¿æŒï¼‰ -->
  <section class="user-stories" id="stories">
    <h2 class="section-title">ç”¨æˆ·æ•…äº‹</h2>
    <div class="story-grid">
      <div class="story-card">
        <h3 class="story-title">ç½‘ç»œå°è¯´ä½œè€…</h3>
        <p class="story-content">"ä½œä¸ºç½‘ç»œå°è¯´ä½œè€…ï¼Œæˆ‘ç»å¸¸éœ€è¦ä¸ºæˆ‘çš„ä½œå“é…å›¾â€¦â€¦"</p>
      </div>
      <div class="story-card">
        <h3 class="story-title">æ¼«ç”»çˆ±å¥½è€…</h3>
        <p class="story-content">"æˆ‘ä¸€ç›´æƒ³æŠŠè‡ªå·±å†™çš„å°æ•…äº‹å˜æˆæ¼«ç”»â€¦â€¦"</p>
      </div>
    </div>
  </section>

  <!-- æŠ€æœ¯äº®ç‚¹ï¼ˆä¿æŒï¼‰ -->
  <section class="tech-highlights" id="tech">
    <h2 class="section-title">æŠ€æœ¯äº®ç‚¹</h2>
    <div class="tech-grid">
      <div class="tech-item"><div class="tech-icon">ğŸ§ </div><h3 class="tech-title">å…ˆè¿›AIæ¨¡å‹</h3><p class="tech-description">é‡‡ç”¨æœ€æ–°çš„AIGCæŠ€æœ¯ï¼Œç²¾å‡†ç†è§£æ–‡æœ¬è¯­ä¹‰</p></div>
      <div class="tech-item"><div class="tech-icon">âš¡</div><h3 class="tech-title">å¿«é€Ÿç”Ÿæˆ</h3><p class="tech-description">äº‘ç«¯å¤„ç†ï¼Œåˆ†é’Ÿçº§ç”Ÿæˆå®Œæ•´æ¼«ç”»åˆ†é•œ</p></div>
      <div class="tech-item"><div class="tech-icon">ğŸ­</div><h3 class="tech-title">è§’è‰²ä¸€è‡´</h3><p class="tech-description">ç‹¬ç‰¹ç®—æ³•ç¡®ä¿è§’è‰²åœ¨ä¸åŒåˆ†é•œä¸­ä¿æŒä¸€è‡´</p></div>
      <div class="tech-item"><div class="tech-icon">ğŸ”„</div><h3 class="tech-title">æŒç»­ä¼˜åŒ–</h3><p class="tech-description">åŸºäºç”¨æˆ·åé¦ˆä¸æ–­æ”¹è¿›ç”Ÿæˆè´¨é‡</p></div>
    </div>
  </section>

  <!-- åº•éƒ¨ï¼šç”Ÿæˆå•æ ¼ç”»é¢ï¼ˆæ”¾åœ¨æœ€ä¸‹é¢ï¼‰ -->
  <section class="generator" id="single">
    <h2 class="section-title">ç”Ÿæˆå•æ ¼ç”»é¢ï¼ˆæµ‹è¯•åŒºï¼‰</h2>
    <div class="generator-container" style="grid-template-columns:1fr">
      <div class="left-card">
        <div class="controls-row">
          <input id="onePrompt" type="text" placeholder="æç¤ºè¯ï¼ˆä¸­è‹±æ–‡çš†å¯ï¼‰ï¼Œä¾‹å¦‚ï¼šblack and white manga panel, rainy street">
          <select id="oneSize"><option>1024x1024</option><option>768x1344</option><option>1344x768</option></select>
          <button class="btn" id="btnOne">ç”Ÿæˆä¸€æ ¼</button>
          <button class="btn secondary" id="btnOneClear">æ¸…ç©º</button>
        </div>
        <div id="oneOut" class="comic-panels" style="grid-template-columns:1fr; margin-top:12px"></div>
      </div>
    </div>
  </section>

  <!-- é¡µè„šï¼ˆä¿æŒï¼‰ -->
  <footer>
    <div class="footer-links">
      <a href="#">éšç§æ”¿ç­–</a><a href="#">ä½¿ç”¨æ¡æ¬¾</a><a href="#">æŠ€æœ¯æ”¯æŒ</a><a href="#">å…³äºæˆ‘ä»¬</a>
    </div>
    <div class="copyright">Â© 2025 NovelToComic. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</div>
  </footer>

<script>
  const API='/api';
  let STOP=false;

  // å·¥å…·å‡½æ•°
  const $ = sel => document.querySelector(sel);
  const esc = s => String(s??'').replace(/[&<>"]/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m]));
  async function postJSON(path, body){
    const r = await fetch(API + path, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
    if(!r.ok) throw new Error(await r.text());
    return r.json();
  }
  function digPanels(sb){
    const list=[]; (sb.pages||[]).forEach((p,pi)=>{ (p.panels||[]).forEach((g,gi)=> list.push({pi,gi,id:g.id??(gi+1),desc:g.desc||''}) );});
    return list;
  }
  function tilesInit(panels){
    const wrap = $('#renderOut'); let html='';
    panels.forEach((p,idx)=>{
      html += `<div class="comic-panel" id="tile-${idx}">
        <div class="panel-image" id="thumb-${idx}">æ’é˜Ÿä¸­â€¦</div>
        <div class="panel-text"><b>#${esc(p.id)}</b> ${esc(p.desc)}</div>
      </div>`;
    });
    wrap.innerHTML = html;
  }
  function setTile(idx, ok, urlOrMsg){
    const el = $('#thumb-'+idx); if(!el) return;
    if(ok){
      el.innerHTML = `<a href="${urlOrMsg}" target="_blank" style="display:block; font-size:12px; margin-bottom:6px">${urlOrMsg}</a>
                      <img loading="lazy" src="${urlOrMsg}" alt="panel ${idx}">`;
    }else{
      el.innerHTML = `<span style="color:#e11d48">å¤±è´¥ï¼š</span><span style="color:#6b7280;font-size:12px">${esc(urlOrMsg)}</span>`;
    }
  }
  async function runPool(limit, tasks, onDone){
    let i=0,done=0;
    async function worker(){
      while(true){
        if(STOP) break;
        const cur=i++; if(cur>=tasks.length) break;
        try{ await tasks[cur](); }catch(_){} finally{ done++; onDone?.(done,tasks.length); }
      }
    }
    await Promise.all(Array.from({length:Math.min(limit,tasks.length)},()=>worker()));
  }

  // é£æ ¼é€‰é¡¹äº¤äº’ + é»˜è®¤å‰ç¼€æ˜ å°„
  let currentStyle = 'æ—¥ç³»æ¸…æ–°';
  let defaultPrefix = 'anime style, clean line art, soft lighting';
  $('#styleOptions').querySelectorAll('.style-option').forEach(opt=>{
    opt.addEventListener('click', ()=>{
      $('#styleOptions').querySelectorAll('.style-option').forEach(o=>o.classList.remove('active'));
      opt.classList.add('active');
      currentStyle = opt.dataset.style || currentStyle;
      defaultPrefix = opt.dataset.prefix || defaultPrefix;
      if(!$('#pprefix').value){ $('#pprefix').placeholder = `ç»Ÿä¸€ç”»é£å‰ç¼€ï¼ˆé»˜è®¤ï¼š${defaultPrefix}ï¼‰`; }
    });
  });

  // å·¦ä¾§ï¼šç”Ÿæˆåˆ†é•œï¼ˆLLMï¼‰
  $('#btnGenerate').addEventListener('click', async ()=>{
    const text = $('#novel').value.trim();
    if(!text){ alert('è¯·è¾“å…¥å°è¯´å†…å®¹'); return; }
    const btn = $('#btnGenerate'); const origin = btn.textContent;
    btn.textContent='ç”Ÿæˆä¸­â€¦'; btn.disabled=true; STOP=false;
    $('#sbout').textContent='(ç”Ÿæˆä¸­â€¦)';
    try{
      const sb = await postJSON('/storyboard', { text, style: currentStyle });
      $('#sbout').textContent = JSON.stringify(JSON.parse(sb.storyboard_json||'{}'), null, 2);
      document.querySelector('details')?.setAttribute('open','');
      // ç”Ÿæˆåè‡ªåŠ¨æ»šåŠ¨åˆ°å³ä¾§æ§åˆ¶åŒº
      document.getElementById('renderOut').scrollIntoView({behavior:'smooth',block:'start'});
    }catch(e){
      $('#sbout').textContent='å¤±è´¥ï¼š'+e.message;
    }finally{
      btn.textContent=origin; btn.disabled=false;
    }
  });

  // å³ä¾§ï¼šå¹¶å‘é€æ ¼æ¸²æŸ“
  $('#btnRenderFE').addEventListener('click', async ()=>{
    STOP=false;
    const sbtxt = $('#sbout').textContent.trim();
    if(!sbtxt || sbtxt[0]!=='{'){ alert('è¯·å…ˆåœ¨å·¦ä¾§ç”Ÿæˆåˆ†é•œ JSON'); return; }
    let sb; try{ sb = JSON.parse(sbtxt); }catch{ alert('åˆ†é•œ JSON è§£æå¤±è´¥'); return; }

    const panels = digPanels(sb);
    if(!panels.length){ alert('åˆ†é•œä¸ºç©º'); return; }

    tilesInit(panels);
    const size = $('#sizeBatch').value || '1024x1024';
    const customPrefix = ($('#pprefix').value || '').trim();
    const prefix = customPrefix || defaultPrefix;
    const limit = Math.max(1, Math.min(6, parseInt($('#concurrency').value||'3',10)));
    const prog = $('#progress'); prog.textContent = `è¿›åº¦ï¼š0/${panels.length}`;

    const tasks = panels.map((p,idx)=> async()=>{
      const prompt = `${prefix ? (prefix+' ') : ''}${p.desc}`.trim();
      try{
        const r = await postJSON('/image', { prompt, size });
        setTile(idx, true, r.url);
      }catch(e){
        setTile(idx, false, e.message || 'error');
      }
    });

    await runPool(limit, tasks, (d,t)=> prog.textContent=`è¿›åº¦ï¼š${d}/${t}`);
    if(!STOP) prog.textContent += ' âœ… å®Œæˆ';
  });

  $('#btnStop').addEventListener('click', ()=>{ STOP=true; $('#progress').textContent += ' Â· å·²è¯·æ±‚åœæ­¢'; });

  $('#btnCopy').addEventListener('click', async ()=>{
    const links = [...document.querySelectorAll('#renderOut a')].map(a=>a.href).filter(Boolean);
    if(!links.length){ alert('æš‚æ— å¯å¤åˆ¶çš„é“¾æ¥'); return; }
    await navigator.clipboard.writeText(links.join('\n'));
    alert('å·²å¤åˆ¶ '+links.length+' æ¡é“¾æ¥');
  });

  $('#btnClear').addEventListener('click', ()=>{
    $('#novel').value=''; $('#sbout').textContent='(å¾…ç”Ÿæˆ)'; $('#renderOut').innerHTML=''; $('#progress').textContent='è¿›åº¦ï¼š0/0';
  });

  // åº•éƒ¨ï¼šç”Ÿæˆå•æ ¼ç”»é¢
  $('#btnOne').addEventListener('click', async ()=>{
    const prompt = $('#onePrompt').value.trim() || 'black and white manga panel, rainy street';
    const size   = $('#oneSize').value || '1024x1024';
    const btn = $('#btnOne'); const origin = btn.textContent; btn.textContent='ç”Ÿæˆä¸­â€¦'; btn.disabled=true;
    const out = $('#oneOut'); out.innerHTML = `<div class="comic-panel"><div class="panel-image">ç”Ÿæˆä¸­â€¦</div></div>`;
    try{
      const r = await postJSON('/image', { prompt, size });
      out.innerHTML = `<div class="comic-panel">
          <div class="panel-image">
            <a href="${r.url}" target="_blank" style="display:block;font-size:12px;margin-bottom:6px">${r.url}</a>
            <img loading="lazy" src="${r.url}" style="max-width:100%;height:auto">
          </div>
        </div>`;
      out.scrollIntoView({behavior:'smooth',block:'start'});
    }catch(e){
      out.innerHTML = `<div class="comic-panel"><div class="panel-image" style="color:#e11d48">å¤±è´¥ï¼š${esc(e.message||'error')}</div></div>`;
    }finally{
      btn.textContent=origin; btn.disabled=false;
    }
  });
  $('#btnOneClear').addEventListener('click', ()=>{ $('#onePrompt').value=''; $('#oneOut').innerHTML=''; });

  // é¡µé¢å°±ç»ªåï¼Œå°†å¯¼èˆªåç§»è€ƒè™‘ï¼ˆé¿å…é”šç‚¹è¢«é¡¶æ ç›–ä½ï¼‰
  if(location.hash){ setTimeout(()=>document.querySelector(location.hash)?.scrollIntoView({behavior:'smooth'}), 200); }
</script>
</body>
</html>
