<!doctype html><html lang="zh-CN"><meta charset="utf-8"/>
<title>ComicGen 漫画生成 MVP</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto;max-width:980px;margin:40px auto;padding:0 16px;background:#0b0f14;color:#e6edf3}
.card{border:1px solid #263241;border-radius:12px;padding:16px;margin:16px 0;background:#111826}
h2{margin:0 0 12px}
textarea,input,select{width:100%;background:#0f1621;color:#e6edf3;border:1px solid #263241;border-radius:10px;padding:10px}
button{background:#1f6feb;border:1px solid #1f6feb;color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer}
pre{white-space:pre-wrap;word-break:break-word;background:#0f1621;padding:12px;border-radius:10px;border:1px solid #263241}
.row{display:flex;gap:8px;align-items:center}
.row>*{flex:1}
img{max-width:100%;border-radius:12px;border:1px solid #263241}
small{color:#9fb5ca}
</style>
<body>
<h1>ComicGen 漫画生成 MVP</h1>

<section class="card">
  <h2>① 小说 → 分镜（七牛云 DeepSeek）</h2>
  <textarea id="novel" rows="8" placeholder="粘贴小说片段（中文）"></textarea>
  <div class="row" style="margin-top:10px">
    <label style="flex:0 0 auto">画风</label>
    <select id="style" style="max-width:220px">
      <option>黑白线稿</option><option>青年热血</option><option>日系清新</option><option>写实阴影</option>
    </select>
    <button id="btnSb">生成分镜 JSON</button>
  </div>
  <pre id="sbout">(等待生成...)</pre>
  <div class="row" style="margin-top:10px">
    <button id="btnRender">批量渲染整页分镜</button>
  </div>
  <pre id="renderOut"></pre>
</section>

<section class="card">
  <h2>② 生成单格画面（七牛云图像）</h2>
  <input id="prompt" placeholder="提示词（中英皆可）" />
  <div class="row" style="margin-top:10px">
    <select id="size" style="max-width:220px">
      <option>1024x1024</option><option>768x1344</option><option>1344x768</option>
    </select>
    <button id="btnImg" style="flex:0 0 auto">生成一格</button>
  </div>
  <div id="imgout" style="margin-top:10px"></div>
  <small>生成成功后文件保存在服务器 /outputs/年/月/日/ 下，并显示公开链接。</small>
</section>

<script>
const API='/api';
async function postJSON(path, body){
  const r = await fetch(API+path,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  if(!r.ok) throw new Error(await r.text()); return r.json();
}
document.getElementById('btnSb').onclick = async ()=>{
  const text=document.getElementById('novel').value.trim();
  const style=document.getElementById('style').value||'黑白线稿';
  const out=document.getElementById('sbout');
  if(!text){ out.textContent='请先粘贴小说文本'; return; }
  out.textContent='(生成中...)';
  try{
    const res=await postJSON('/storyboard',{text,style});
    out.textContent=JSON.stringify(JSON.parse(res.storyboard_json||'{}'),null,2);
  }catch(e){ out.textContent='请求失败：'+e.message; }
};
document.getElementById('btnImg').onclick = async ()=>{
  const prompt=document.getElementById('prompt').value||'black and white manga panel';
  const size=document.getElementById('size').value||'1024x1024';
  const div=document.getElementById('imgout');
  div.innerHTML='(生成中...)';
  try{
    const r=await postJSON('/image',{prompt,size});
    div.innerHTML=`<a href="${r.url}" target="_blank">${r.url}</a><br/><img src="${r.url}">`;
  }catch(e){ div.textContent='请求失败：'+e.message; }
};
document.getElementById('btnRender').onclick = async ()=>{
  const sbtxt=document.getElementById('sbout').textContent.trim();
  const renderOut=document.getElementById('renderOut');
  if(!sbtxt||sbtxt[0]!=='{'){ renderOut.textContent='请先生成分镜 JSON'; return; }
  renderOut.textContent='(批量生成中...)';
  try{
    const r=await postJSON('/render',{storyboard_json:sbtxt,size:'1024x1024',prompt_prefix:'black and white manga, dramatic lighting'});
    renderOut.textContent=JSON.stringify(JSON.parse(r.storyboard_json||'{}'),null,2);
  }catch(e){ renderOut.textContent='失败：'+e.message; }
};
</script>
</body></html>
